<style>
    .notify{
        display: none;
    }
</style>
<div class="layui-layout layui-layout-admin" style="padding-left: 40px;margin-top: 20px;">
    <form class="layui-form" action="" method="post" >
        <div class="layui-form-item">
            <label class="layui-form-label mw200">任务名称</label>
            <div class="layui-input-inline mw400">
                <input type="text" name="task_name" id="task_name" lay-verify="required" autocomplete="off" placeholder="任务名称" class="layui-input" value="">
            </div>
            <div class="layui-form-mid layui-word-aux"></div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label mw200">所属分组</label>
            <div class="layui-input-inline">
                <select name="group_id" lay-verify="required">
                {{range $k, $v := .taskGroup}}
                    <option value="{{$k}}">{{$v}}</option>
                {{end}}
                </select>
            </div>
            <div class="layui-form-mid layui-word-aux"></div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label mw200">服务器资源</label>
            <div class="layui-inline">

                <div class="layui-input-inline">
                    <select name="server_id">
                        <option value="0">本地服务器</option>
                        {{range $k, $v := .serverGroup}}
                            <optgroup label="{{$v.GroupName}}">
                                {{range $kk, $vv := $v.Servers}}
                                    <option value="{{$kk}}">{{$vv}}</option>
                                {{end}}
                            </optgroup>
                        {{end}}
                    </select>
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label mw200">任务说明</label>
            <div class="layui-input-inline mw400">
                <textarea name="description" id="description" rows="2" placeholder="请输入内容" class="layui-textarea"></textarea>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label mw200">是否单例</label>
            <div class="layui-input-inline ">

                <input type="radio" name="concurrent" lay-verify="required" value="0" title="是" checked>
                <input type="radio" name="concurrent" lay-verify="required" value="1" title="否" >

            </div>
            <div class="layui-form-mid layui-word-aux"><i class="fa fa-info-circle" aria-hidden="true" id="des"></i></div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label mw200">时间表达式</label>
            <div class="layui-input-inline mw400">
                <input type="text" name="cron_spec" id="cron_spec" lay-verify="required" autocomplete="off" placeholder="时间表达式" class="layui-input" value="">
            </div>
            <div class="layui-form-mid layui-word-aux"><i class="fa fa-info-circle" aria-hidden="true" id="des2"></i></div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label mw200">命令脚本</label>
            <div class="layui-input-inline mw400">
                <textarea name="command" id="command" rows="5" placeholder="请输入命令内容" class="layui-textarea"></textarea>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label mw200">超时设置</label>
            <div class="layui-input-inline">
                <input type="text" name="timeout" id="timeout" lay-verify="required" autocomplete="off" placeholder="单位：秒，默认一天" class="layui-input" value="">
            </div>
            <div class="layui-form-mid layui-word-aux"></div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label mw200">出错通知</label>
            <div class="layui-input-inline ">
                <input type="radio" name="is_notify" lay-verify="required" value="1" lay-filter="is_notify" title="是" >
                <input type="radio" name="is_notify" lay-verify="required" value="0" lay-filter="is_notify" title="否" checked>
            </div>
            <div class="layui-form-mid layui-word-aux"></div>
        </div>

        <div class="layui-form-item notify">
            <hr>
            <label class="layui-form-label mw200">通知类型</label>
            <div class="layui-input-inline ">
                <input type="radio" name="notify_type" lay-verify="required" value="0" title="邮件" checked>
                <input type="radio" name="notify_type" lay-verify="required" value="1" title="短信" >
            </div>
            <div class="layui-form-mid layui-word-aux"></div>
        </div>

        <div class="layui-form-item  notify">
            <label class="layui-form-label mw200">通知用户</label>
            <div class="layui-input-inline mw400 ">
            {{range $k, $v := .adminInfo}}
                <input type="checkbox" name="notify_user" lay-filter="notify_user" title="{{$v.RealName}}" value="{{$v.Id}}" lay-skin="primary">
            {{end}}
                <input type="hidden" name="notify_user_ids" id="notify_user_ids" value="">
            </div>
            <div class="layui-form-mid layui-word-aux"></div>
        </div>


        <input type="hidden" name="id" id="id" value="0">
        <div class="layui-form-item">
            <label class="layui-form-label mw200"></label>
            <div class="layui-input-inline mw400">
                <button class="layui-btn" lay-submit="" lay-filter="sub">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</div>
<script>
    layui.use(['form','element','layer','jquery'],function(){
        var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
        var $ = layui.jquery;
        var error_info = "{{.flash.error}}";
        if(error_info){
            layer.msg(error_info,{icon: 2,shade:0.3},function () {
                window.history.go(-1)
            })
            return;
        }
        $("#des").on('click',function () {
            layer.tips('设为“是”的话，如果该任务在上一个时间点还没执行完，则略过不执行', '#des', {
                tips: [1, '#0FA6D8'] //还可配置颜色
            });
        })

        $("#des2").on('click',function () {
            layer.open({
                type: 1
                ,title: false
                ,closeBtn: true
                ,area: '800px;'
                ,shade: 0.6
                ,id: 'LAY_layuipro' //设定一个id，防止重复弹出
                ,btnAlign: 'c'
                ,moveType: 1 //拖拽模式，0或者1
                ,content: '<div style="padding: 10px; line-height: 22px; background-color: #393D49; color: #fff; ' +
                'font-weight: 300;"><div class="article-content mt20 editormd-preview-theme-dark markdown-body editormd-html-preview" id="art_content" style="overflow: hidden;">\n' +
                '                    \n' +
                '                <h3 id="h3-cron-"><a name="Cron表达式说明" class="reference-link"></a><span class="header-link octicon octicon-link"></span>Cron表达式说明</h3><p>Cron表达式是一个字符串，字符串以空格隔开，分为5或6个域，每一个域代表一个含义，系统支持的表达式格式如下：</p>\n' +
                '<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="pln">   </span><span class="typ">Seconds</span><span class="pln"> </span><span class="typ">Minutes</span><span class="pln"> </span><span class="typ">Hours</span><span class="pln"> </span><span class="typ">DayofMonth</span><span class="pln"> </span><span class="typ">Month</span><span class="pln"> </span><span class="pun">[</span><span class="typ">DayofWeek</span><span class="pun">]</span></code></li></ol></pre><p>其中 DayofWeek 为可选域。<br>每一个域可出现的字符如下：</p>\n' +
                '<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="typ">Seconds</span><span class="pun">:</span><span class="pln"> </span><span class="pun">可出现</span><span class="str">"* / , -"</span><span class="pun">四个字符，有效范围为</span><span class="lit">0</span><span class="pun">-</span><span class="lit">59</span><span class="pun">的整数</span></code></li><li class="L1"><code><span class="typ">Minutes</span><span class="pun">:</span><span class="pln"> </span><span class="pun">可出现</span><span class="str">"* / , -"</span><span class="pun">四个字符，有效范围为</span><span class="lit">0</span><span class="pun">-</span><span class="lit">59</span><span class="pun">的整数</span></code></li><li class="L2"><code><span class="typ">Hours</span><span class="pun">:</span><span class="pln"> </span><span class="pun">可出现</span><span class="str">"* / , -"</span><span class="pun">四个字符，有效范围为</span><span class="lit">0</span><span class="pun">-</span><span class="lit">23</span><span class="pun">的整数</span></code></li><li class="L3"><code><span class="typ">DayofMonth</span><span class="pun">:</span><span class="pln"> </span><span class="pun">可出现</span><span class="str">"* / , - ?"</span><span class="pun">五个字符，有效范围为</span><span class="lit">0</span><span class="pun">-</span><span class="lit">31</span><span class="pun">的整数</span></code></li><li class="L4"><code><span class="typ">Month</span><span class="pun">:</span><span class="pln"> </span><span class="pun">可出现</span><span class="str">", - * /"</span><span class="pun">四个字符，有效范围为</span><span class="lit">1</span><span class="pun">-</span><span class="lit">12</span><span class="pun">的整数或</span><span class="pln">JAN</span><span class="pun">-</span><span class="pln">DEC</span></code></li><li class="L5"><code><span class="typ">DayofWeek</span><span class="pun">:</span><span class="pln"> </span><span class="pun">可出现</span><span class="str">"* / , - ?"</span><span class="pun">五个字符，有效范围为</span><span class="lit">0</span><span class="pun">-</span><span class="lit">6</span><span class="pun">的整数或</span><span class="pln">SUN</span><span class="pun">-</span><span class="pln">SAT</span><span class="pun">两个范围。</span><span class="lit">0</span><span class="pun">表示星期天，</span><span class="lit">1</span><span class="pun">表示星期一，</span><span class="pln"> </span><span class="pun">依次类推</span></code></li></ol></pre><p>各个字符的含义如下：</p>\n' +
                '<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="pun">*</span><span class="pln"> </span><span class="pun">表示匹配该域的任意值，假如在</span><span class="typ">Minutes</span><span class="pun">域使用*,</span><span class="pln"> </span><span class="pun">即表示每分钟都会触发事件。</span></code></li><li class="L1"><code><span class="pun">?</span><span class="pln"> </span><span class="pun">字符仅被用于天（月）和天（星期）两个子表达式，表示不指定值，当</span><span class="lit">2</span><span class="pun">个子表达式其中之一被指定了值以后，为了避免冲突，需要将另一个子表达式的值设为“?”。</span></code></li><li class="L2"><code><span class="pun">-</span><span class="pln"> </span><span class="pun">表示范围，例如在</span><span class="typ">Minutes</span><span class="pun">域使用</span><span class="lit">5</span><span class="pun">-</span><span class="lit">20</span><span class="pun">，表示从</span><span class="lit">5</span><span class="pun">分到</span><span class="lit">20</span><span class="pun">分钟每分钟触发一次。</span></code></li><li class="L3"><code><span class="pun">/</span><span class="pln"> </span><span class="pun">表示起始时间开始触发，然后每隔固定时间触发一次，例如在</span><span class="typ">Minutes</span><span class="pun">域使用</span><span class="lit">5</span><span class="pun">/</span><span class="lit">20</span><span class="pun">,则意味着</span><span class="lit">5</span><span class="pun">分钟触发一次，而</span><span class="lit">25</span><span class="pun">，</span><span class="lit">45</span><span class="pun">等分别触发一次。</span></code></li><li class="L4"><code><span class="pun">,</span><span class="pln"> </span><span class="pun">表示列出枚举值值。例如：在</span><span class="typ">Minutes</span><span class="pun">域使用</span><span class="lit">5</span><span class="pun">,</span><span class="lit">20</span><span class="pun">，则意味着在</span><span class="lit">5</span><span class="pun">和</span><span class="lit">20</span><span class="pun">分每分钟触发一次。</span></code></li></ol></pre><p>一些例子：</p>\n' +
                '<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="lit">14</span><span class="pun">,</span><span class="lit">16</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">每天上午</span><span class="lit">10</span><span class="pun">点，下午</span><span class="lit">2</span><span class="pun">点，</span><span class="lit">4</span><span class="pun">点触发</span></code></li><li class="L1"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">0</span><span class="pun">/</span><span class="lit">30</span><span class="pln"> </span><span class="lit">9</span><span class="pun">-</span><span class="lit">17</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">朝九晚五工作时间内每半小时触发</span></code></li><li class="L2"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="lit">12</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> WED </span><span class="pun">表示每个星期三中午</span><span class="lit">12</span><span class="pun">点触发</span></code></li><li class="L3"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="lit">12</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">每天中午</span><span class="lit">12</span><span class="pun">点触发</span></code></li><li class="L4"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">15</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">每天上午</span><span class="lit">10</span><span class="pun">:</span><span class="lit">15</span><span class="pun">触发</span></code></li><li class="L5"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">15</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">每天上午</span><span class="lit">10</span><span class="pun">:</span><span class="lit">15</span><span class="pun">触发</span></code></li><li class="L6"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">15</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">每天上午</span><span class="lit">10</span><span class="pun">:</span><span class="lit">15</span><span class="pun">触发</span></code></li><li class="L7"><code><span class="lit">0</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">14</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">在每天下午</span><span class="lit">2</span><span class="pun">点到下午</span><span class="lit">2</span><span class="pun">:</span><span class="lit">59</span><span class="pun">期间的每</span><span class="lit">1</span><span class="pun">分钟触发</span></code></li><li class="L8"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">0</span><span class="pun">/</span><span class="lit">5</span><span class="pln"> </span><span class="lit">14</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">在每天下午</span><span class="lit">2</span><span class="pun">点到下午</span><span class="lit">2</span><span class="pun">:</span><span class="lit">55</span><span class="pun">期间的每</span><span class="lit">5</span><span class="pun">分钟触发</span></code></li><li class="L9"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">0</span><span class="pun">/</span><span class="lit">5</span><span class="pln"> </span><span class="lit">14</span><span class="pun">,</span><span class="lit">18</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">在每天下午</span><span class="lit">2</span><span class="pun">点到</span><span class="lit">2</span><span class="pun">:</span><span class="lit">55</span><span class="pun">期间和下午</span><span class="lit">6</span><span class="pun">点到</span><span class="lit">6</span><span class="pun">:</span><span class="lit">55</span><span class="pun">期间的每</span><span class="lit">5</span><span class="pun">分钟触发</span></code></li><li class="L0"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">0</span><span class="pun">-</span><span class="lit">5</span><span class="pln"> </span><span class="lit">14</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">在每天下午</span><span class="lit">2</span><span class="pun">点到下午</span><span class="lit">2</span><span class="pun">:</span><span class="lit">05</span><span class="pun">期间的每</span><span class="lit">1</span><span class="pun">分钟触发</span></code></li><li class="L1"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="lit">44</span><span class="pln"> </span><span class="lit">14</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> WED </span><span class="pun">每年三月的星期三的下午</span><span class="lit">2</span><span class="pun">:</span><span class="lit">10</span><span class="pun">和</span><span class="lit">2</span><span class="pun">:</span><span class="lit">44</span><span class="pun">触发</span></code></li><li class="L2"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">15</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> MON</span><span class="pun">-</span><span class="pln">FRI </span><span class="pun">周一至周五的上午</span><span class="lit">10</span><span class="pun">:</span><span class="lit">15</span><span class="pun">触发</span></code></li><li class="L3"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">15</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="lit">15</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">每月</span><span class="lit">15</span><span class="pun">日上午</span><span class="lit">10</span><span class="pun">:</span><span class="lit">15</span><span class="pun">触发</span></code></li><li class="L4"><code><span class="lit">0</span><span class="pln"> </span><span class="lit">15</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> L </span><span class="pun">*</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">每月最后一日的上午</span><span class="lit">10</span><span class="pun">:</span><span class="lit">15</span><span class="pun">触发</span></code></li></ol></pre></div></div>'

            });

        })


        var notify_user_ids = [];
        form.on('checkbox(notify_user)', function(data){
            if(data.elem.checked==true){
                notify_user_ids.push(data.value)
            }else{
                $.each(notify_user_ids,function(index,item){
                    // index是索引值（即下标）   item是每次遍历得到的值；
                    if(item==data.value){
                        notify_user_ids.splice(index,1);
                    }
                });
            }
            $("#notify_user_ids").val(notify_user_ids.join(","));
        });
        form.on('radio(is_notify)', function(data){
            if(data.value==1){
                $(".notify").show()
            }else{
                $(".notify").hide()
            }
        });



        form.on('submit(sub)', function(data){
            var form_data = data.field;
            $.post('{{urlfor "TaskController.AjaxSave"}}', form_data, function (out) {
                if (out.status == 0) {
                    layer.msg("操作成功",{icon: 1,shade:0.3,time:1000},function () {
                        window.history.go(-1)
                    })
                } else {
                    layer.msg(out.message)
                }
            }, "json");
            return false;
        });

        //但是，如果你的HTML是动态生成的，自动渲染就会失效
        //因此你需要在相应的地方，执行下述方法来手动渲染，跟这类似的还有 element.init();
        form.render();
    });
</script>